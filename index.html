<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flu Tools</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<meta name="color-scheme" content="dark light">
<style>
:root{
  --bg:#0a0b10; --bg2:#0f1220; --card:#121527; --surface:#171a30; --muted:#aab0c0; --txt:#e9eef7;
  --accent:#30d5c8; --accent2:#8a5cff; --ok:#20c997; --warn:#ffb020; --danger:#ff5861;
  --ring:0 0 0 1px rgba(255,255,255,.06), 0 10px 30px rgba(0,0,0,.35);
  --r:18px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; color:var(--txt);
  background:
    radial-gradient(900px 600px at -10% -10%, rgba(48,213,200,.15), transparent 40%),
    radial-gradient(900px 600px at 110% 0%, rgba(138,92,255,.10), transparent 40%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  display:grid; grid-template-columns: 250px 1fr;
}
/* AUTH GATE */
#gate{position:fixed; inset:0; display:grid; place-items:center; backdrop-filter: blur(8px);
  background: linear-gradient(180deg, rgba(10,11,16,.8), rgba(10,11,16,.92)); z-index:9999}
#gate .panel{width:min(520px,95vw); background:var(--card); border-radius:22px; padding:22px; box-shadow:var(--ring); border:1px solid rgba(255,255,255,.08)}
.brand{font-weight:800; font-size:24px; letter-spacing:.3px}
.sub{color:var(--muted); font-size:13px}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
input[type="password"], input[type="text"], select, textarea{ width:100%; background:var(--surface); color:var(--txt);
  border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px 12px; outline:none }
.btn{ cursor:pointer; user-select:none; border:1px solid rgba(255,255,255,.08); padding:12px 14px; border-radius:14px; background:var(--surface)}
.btn.primary{background:linear-gradient(180deg, var(--accent), #20a6a4); color:#061212; font-weight:800}
.btn.ghost{background:transparent}
.hint{font-size:12px; color:var(--muted)}
.err{color:#ff8c98; font-size:12px; min-height:18px}

aside{padding:18px; border-right:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.25); backdrop-filter: blur(6px);}
nav a{display:flex; gap:10px; padding:10px 12px; margin:6px 0; text-decoration:none; color:var(--txt); border-radius:12px; font-weight:600}
nav a:hover{background:rgba(255,255,255,.06)}
nav a.active{background:linear-gradient(90deg, rgba(48,213,200,.18), rgba(138,92,255,.18)); outline:1px solid rgba(255,255,255,.1)}

main{padding:24px 28px}
h1{margin:0 0 18px; font-size:34px}
.grid{display:grid; grid-template-columns: 1.05fr .95fr; gap:18px}
.card{background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:var(--r); padding:16px; box-shadow:var(--ring)}
label{font-size:12px; color:var(--muted); display:block; margin:6px 0}
.muted{color:var(--muted); font-size:12px}
.split{display:grid; grid-template-columns:1fr 1fr; gap:12px}
.stack{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
.preview{width:100%; aspect-ratio:16/9; background:#07080e; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
video, canvas{width:100%; height:100%; object-fit:cover}

@media (max-width:980px){ body{grid-template-columns:1fr} .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<!-- AUTH GATE -->
<div id="gate" aria-hidden="true">
  <div class="panel">
    <div class="row" style="justify-content:space-between">
      <div class="brand">Flu Tools – Access</div>
      <div class="sub">Private session</div>
    </div>
    <div style="height:12px"></div>
    <label>Enter passcode</label>
    <input id="pw" type="password" inputmode="numeric" autocomplete="current-password" placeholder="••••" />
    <div class="err" id="err"></div>
    <div class="row" style="justify-content:space-between">
      <button id="enter" class="btn primary">Unlock</button>
      <span class="hint">Attempts left: <b id="left">5</b></span>
    </div>
  </div>
</div>

<aside>
  <div class="brand">Flu Tools</div>
  <nav>
    <a href="#webcam">Webcam</a>
    <a href="#screen">Screen Recorder</a>
    <a href="#voice">Voice</a>
    <a href="#snapshot">Snapshot</a>
    <a href="#files">File Tools</a>
    <a href="#text">Text Tools</a>
    <a href="#clipboard">Clipboard</a>
    <a href="#network">Network</a>
    <a href="#discord">Discord Panel</a>
    <a href="#settings">Settings</a>
  </nav>
  <div class="muted" style="margin-top:8px">Hosted on GitHub Pages</div>
</aside>

<main>
<h1 id="title">Webcam</h1>

<!-- WEBCAM -->
<section id="webcam" class="grid">
  <div class="card">
    <div class="split">
      <div>
        <label>Camera</label>
        <select id="camSel"></select>
      </div>
      <div>
        <label>Microphone</label>
        <select id="micSel"></select>
      </div>
    </div>
    <div class="stack" style="margin:10px 0 6px">
      <button class="btn" id="camRefresh">Refresh</button>
      <button class="btn" id="camPreview">Preview</button>
      <button class="btn" id="camRecord">Record</button>
      <button class="btn" id="camStop" disabled>Stop</button>
      <a class="btn" id="camDownload" style="display:none" download="flu-capture.webm">Download</a>
    </div>
    <label><input type="checkbox" id="includeSystem"/> Include desktop audio mix</label>
    <pre class="card" style="max-height:180px; overflow:auto" id="devList">—</pre>
  </div>
  <div class="card">
    <div class="preview"><video id="camPrev" autoplay playsinline muted></video></div>
    <div class="muted" id="camInfo" style="margin-top:8px">—</div>
  </div>
</section>

<!-- SCREEN RECORDER -->
<section id="screen" class="card" style="display:none">
  <h2>Screen Recorder</h2>
  <div class="stack">
    <button class="btn" id="scrStart">Pick Screen/Window</button>
    <button class="btn" id="scrStop" disabled>Stop</button>
    <a class="btn" id="scrDownload" style="display:none" download="flu-screen.webm">Download</a>
  </div>
  <div class="preview" style="margin-top:10px"><video id="scrPrev" autoplay playsinline muted></video></div>
</section>

<!-- VOICE -->
<section id="voice" class="card" style="display:none">
  <h2>Voice Recorder</h2>
  <div class="stack">
    <button class="btn" id="vStart">Start</button>
    <button class="btn" id="vStop" disabled>Stop</button>
    <a class="btn" id="vDownload" style="display:none" download="flu-voice.webm">Download</a>
  </div>
  <audio id="vPlayer" controls style="width:100%; margin-top:10px"></audio>
</section>

<!-- SNAPSHOT -->
<section id="snapshot" class="grid" style="display:none">
  <div class="card">
    <div class="stack">
      <button class="btn" id="snapPreview">Preview Camera</button>
      <button class="btn" id="takeSnap" disabled>Take Snapshot</button>
      <a class="btn" id="snapDownload" style="display:none" download="flu-snapshot.png">Download PNG</a>
    </div>
    <div class="preview" style="margin-top:10px"><video id="snapPrev" autoplay playsinline muted></video></div>
  </div>
  <div class="card">
    <div class="preview"><canvas id="snapCanvas"></canvas></div>
    <div class="muted" style="margin-top:8px">Tip: snapshots are 16:9 of the live feed.</div>
  </div>
</section>

<!-- FILE TOOLS -->
<section id="files" class="card" style="display:none">
  <h2>File Tools</h2>
  <label>Image → Base64</label>
  <input type="file" id="imgInput" accept="image/*" />
  <textarea id="b64Out" class="card" style="width:100%; height:160px; background:var(--surface); resize:vertical"></textarea>
  <div class="stack">
    <button class="btn" id="copyB64">Copy</button>
    <button class="btn" id="clearB64">Clear</button>
  </div>
</section>

<!-- TEXT TOOLS -->
<section id="text" class="card" style="display:none">
  <h2>Text Tools</h2>
  <textarea id="txtIn" class="card" style="width:100%; height:160px; background:var(--surface); resize:vertical" placeholder="Paste text…"></textarea>
  <div class="stack">
    <button class="btn" id="wcBtn">Count Words/Chars</button>
    <span class="muted" id="wcInfo">—</span>
  </div>
</section>

<!-- CLIPBOARD -->
<section id="clipboard" class="card" style="display:none">
  <h2>Clipboard</h2>
  <div class="stack">
    <button class="btn" id="clipRead">Read Text</button>
    <button class="btn" id="clipWrite">Write Sample Text</button>
  </div>
  <pre id="clipOut" class="card" style="margin-top:10px; max-height:160px; overflow:auto">—</pre>
</section>

<!-- NETWORK -->
<section id="network" class="card" style="display:none">
  <h2>Network</h2>
  <div class="split">
    <div>
      <label>URL to fetch</label>
      <input id="urlIn" type="text" placeholder="https://example.com" value="https://example.com" />
    </div>
    <div class="stack" style="align-items:flex-end">
      <button class="btn" id="httpGet">GET</button>
      <button class="btn" id="httpHead">HEAD</button>
    </div>
  </div>
  <pre id="netOut" class="card" style="margin-top:10px; max-height:240px; overflow:auto">—</pre>
</section>

<!-- DISCORD PANEL -->
<section id="discord" class="card" style="display:none">
  <h2>Discord Helper</h2>
  <div class="stack">
    <button class="btn" onclick="mockDiscord('!userinfo')">!userinfo</button>
    <button class="btn" onclick="mockDiscord('!mutuals')">!mutuals</button>
    <button class="btn" onclick="mockDiscord(';weekly')">;weekly</button>
    <button class="btn" onclick="mockDiscord(';monthly')">;monthly</button>
    <button class="btn" onclick="mockDiscord('serverinfo')">serverinfo</button>
  </div>
  <pre id="discordOut" class="card" style="margin-top:10px; max-height:300px; overflow:auto">—</pre>
</section>

<!-- SETTINGS -->
<section id="settings" class="card" style="display:none">
  <h2>Settings</h2>
  <label><input type="checkbox" id="autoTheme"> Auto theme based on system</label>
  <div class="muted">Your unlock is remembered for this tab only (sessionStorage).<br/>Forgotten on tab close.</div>
</section>

<script>
// ---------- ROUTER ----------
const links=[...document.querySelectorAll('nav a')];
function setRoute(){
  const hash=(location.hash||'#webcam').replace('#','');
  links.forEach(a=>a.classList.toggle('active', a.getAttribute('href')==='#'+hash));
  document.getElementById('title').textContent=hash.replace(/^[a-z]/,m=>m.toUpperCase());
  ['webcam','screen','voice','snapshot','files','text','clipboard','network','discord','settings'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.style.display=(id===hash?['webcam','snapshot'].includes(id)?'grid':'block':'none');
  });
}
addEventListener('hashchange', setRoute);

// ---------- AUTH ----------
const gate=document.getElementById('gate');
const err=document.getElementById('err');
const left=document.getElementById('left');
const pwInput=document.getElementById('pw');
let attempts=5;
document.getElementById('enter').onclick=()=>{
  if(pwInput.value==='5782'){ gate.style.display='none'; sessionStorage.setItem('unlocked','1'); }
  else{ attempts--; err.textContent='Wrong passcode'; left.textContent=attempts; if(attempts<=0){pwInput.disabled=true;}} 
};
if(sessionStorage.getItem('unlocked')) gate.style.display='none';

// ---------- WEBCAM ----------
let camStream, camRecorder, camData=[];
const camPrev=document.getElementById('camPrev');
const camDownload=document.getElementById('camDownload');
async function refreshCam(){
  const devices=await navigator.mediaDevices.enumerateDevices();
  const cams=devices.filter(d=>d.kind==='videoinput');
  const mics=devices.filter(d=>d.kind==='audioinput');
  const camSel=document.getElementById('camSel'), micSel=document.getElementById('micSel');
  camSel.innerHTML=''; cams.forEach(d=>camSel.add(new Option(d.label,d.deviceId)));
  micSel.innerHTML=''; mics.forEach(d=>micSel.add(new Option(d.label,d.deviceId)));
  document.getElementById('devList').textContent=JSON.stringify(devices,null,2);
}
document.getElementById('camRefresh').onclick=refreshCam;
document.getElementById('camPreview').onclick=async()=>{
  if(camStream) camStream.getTracks().forEach(t=>t.stop());
  camStream=await navigator.mediaDevices.getUserMedia({
    video:{deviceId:document.getElementById('camSel').value||undefined},
    audio:document.getElementById('micSel').value?{deviceId:document.getElementById('micSel').value}:false
  });
  camPrev.srcObject=camStream;
};
document.getElementById('camRecord').onclick=()=>{
  camData=[]; camRecorder=new MediaRecorder(camStream); camRecorder.ondataavailable=e=>camData.push(e.data);
  camRecorder.onstop=()=>{ camDownload.href=URL.createObjectURL(new Blob(camData,{type:'video/webm'})); camDownload.style.display='inline-block'; };
  camRecorder.start(); document.getElementById('camStop').disabled=false;
};
document.getElementById('camStop').onclick=()=>{ camRecorder.stop(); document.getElementById('camStop').disabled=true; };

// ---------- SCREEN ----------
let scrStream, scrRecorder, scrData=[];
const scrPrev=document.getElementById('scrPrev'); 
document.getElementById('scrStart').onclick=async()=>{
  scrStream=await navigator.mediaDevices.getDisplayMedia({video:true,audio:true});
  scrPrev.srcObject=scrStream;
  scrData=[]; scrRecorder=new MediaRecorder(scrStream); scrRecorder.ondataavailable=e=>scrData.push(e.data);
  scrRecorder.onstop=()=>{ document.getElementById('scrDownload').href=URL.createObjectURL(new Blob(scrData,{type:'video/webm'})); document.getElementById('scrDownload').style.display='inline-block';};
  scrRecorder.start(); document.getElementById('scrStop').disabled=false;
};
document.getElementById('scrStop').onclick=()=>{ scrRecorder.stop(); document.getElementById('scrStop').disabled=true; };

// ---------- VOICE ----------
let vStream, vRecorder, vData=[];
const vPlayer=document.getElementById('vPlayer');
document.getElementById('vStart').onclick=async()=>{
  vStream=await navigator.mediaDevices.getUserMedia({audio:true});
  vData=[]; vRecorder=new MediaRecorder(vStream); vRecorder.ondataavailable=e=>vData.push(e.data);
  vRecorder.onstop=()=>{ vPlayer.src=URL.createObjectURL(new Blob(vData,{type:'audio/webm'})); document.getElementById('vDownload').href=vPlayer.src; document.getElementById('vDownload').style.display='inline-block';};
  vRecorder.start(); document.getElementById('vStop').disabled=false;
};
document.getElementById('vStop').onclick=()=>{ vRecorder.stop(); document.getElementById('vStop').disabled=true; };

// ---------- SNAPSHOT ----------
let snapStream;
const snapPrev=document.getElementById('snapPrev');
const snapCanvas=document.getElementById('snapCanvas');
const snapCtx=snapCanvas.getContext('2d');
document.getElementById('snapPreview').onclick=async()=>{
  snapStream=await navigator.mediaDevices.getUserMedia({video:true});
  snapPrev.srcObject=snapStream;
  document.getElementById('takeSnap').disabled=false;
};
document.getElementById('takeSnap').onclick=()=>{
  snapCanvas.width=640; snapCanvas.height=360;
  snapCtx.drawImage(snapPrev,0,0,640,360);
  document.getElementById('snapDownload').href=snapCanvas.toDataURL(); document.getElementById('snapDownload').style.display='inline-block';
};

// ---------- FILE TOOLS ----------
document.getElementById('imgInput').onchange=e=>{
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=()=>document.getElementById('b64Out').value=reader.result;
  reader.readAsDataURL(file);
};
document.getElementById('copyB64').onclick=()=>navigator.clipboard.writeText(document.getElementById('b64Out').value);
document.getElementById('clearB64').onclick=()=>document.getElementById('b64Out').value='';

// ---------- TEXT TOOLS ----------
document.getElementById('wcBtn').onclick=()=>{
  const val=document.getElementById('txtIn').value;
  const words=val.trim().split(/\s+/).filter(Boolean).length;
  const chars=val.length;
  document.getElementById('wcInfo').textContent=`Words: ${words}, Characters: ${chars}`;
};

// ---------- CLIPBOARD ----------
document.getElementById('clipRead').onclick=async()=>document.getElementById('clipOut').textContent=await navigator.clipboard.readText();
document.getElementById('clipWrite').onclick=()=>navigator.clipboard.writeText('Sample text from Flu Tools');

// ---------- NETWORK ----------
document.getElementById('httpGet').onclick=async()=>{
  const url=document.getElementById('urlIn').value;
  try{ const res=await fetch(url); const txt=await res.text(); document.getElementById('netOut').textContent=txt.slice(0,2000)+'\n...'; }
  catch(e){document.getElementById('netOut').textContent=e}
};
document.getElementById('httpHead').onclick=async()=>{
  const url=document.getElementById('urlIn').value;
  try{ const res=await fetch(url,{method:'HEAD'}); document.getElementById('netOut').textContent=JSON.stringify([...res.headers],null,2); }
  catch(e){document.getElementById('netOut').textContent=e}
};

// ---------- DISCORD PANEL ----------
function mockDiscord(cmd){
  document.getElementById('discordOut').textContent=`Executed: ${cmd}\n\nMock result:\n`+JSON.stringify({user:'Flu',contrib:42,mutuals:10},null,2);
}

// ---------- SETTINGS ----------
document.getElementById('autoTheme').onchange=e=>{
  document.documentElement.style.colorScheme=e.target.checked?'dark':'light';
};

// INITIALIZATION
refreshCam(); setRoute();
</script>
</body>
</html>
